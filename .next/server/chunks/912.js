exports.id=912,exports.ids=[912],exports.modules={144:(e,a,o)=>{"use strict";o.d(a,{Di:()=>s});let s=e=>e.auth.isLoading},1195:(e,a,o)=>{"use strict";o.a(e,async(e,s)=>{try{o.d(a,{R:()=>r});var t=o(1428),n=e([t]);let r=(t=(n.then?(await n)():n)[0]).default.create({baseURL:"https://nodejs-hw-mongodb-auth-syz8.onrender.com",withCredentials:!0});t.default.defaults.withCredentials=!0,r.interceptors.response.use(e=>e,e=>(e.response?.status===401&&(console.error("Unauthorized, logging out..."),localStorage.removeItem("token"),window.location.href="/"),Promise.reject(e))),t.default.create({baseURL:"https://66b1f8e71ca8ad33d4f5f63e.mockapi.io"}).interceptors.response.use(e=>e,e=>(e.response?.status===401&&(console.error("Unauthorized, logging out..."),localStorage.removeItem("token"),window.location.href="/"),Promise.reject(e))),s()}catch(e){s(e)}})},3182:(e,a,o)=>{"use strict";o.d(a,{A:()=>l});var s=o(8732),t=o(8185),n=o(8263),r=o.n(n);function l(){return(0,s.jsx)("div",{className:r().loaderContainer,children:(0,s.jsx)("section",{className:r().loader,children:(0,s.jsx)(t.RotatingLines,{visible:!0,height:"96",width:"96",strokeColor:"#407bff",strokeWidth:"5",animationDuration:"0.75",ariaLabel:"rotating-lines-loading"})})})}},4800:(e,a,o)=>{"use strict";o.a(e,async(e,s)=>{try{o.d(a,{$4:()=>f,E8:()=>g,EV:()=>d,LE:()=>m,WT:()=>p,dt:()=>T,je:()=>h,jf:()=>k,kz:()=>i,wz:()=>u,xw:()=>y,yd:()=>E});var t=o(1195),n=o(9198),r=o(8129),l=e([t,n,r]);[t,n,r]=l.then?(await l)():l;let d=e=>{if(console.log("\uD83D\uDD0E Checking accessToken in setAuthHeader:",e),!e){console.warn("⚠️ No access token provided. Authorization header NOT set.");return}t.R.defaults.headers.common.Authorization=`Bearer ${e}`,console.log("✅ AUTH HEADER SET:",t.R.defaults.headers.common.Authorization)},c=()=>{delete t.R.defaults.headers.common.Authorization},i=(0,n.createAsyncThunk)("auth/register",async(e,a)=>{try{let a=await t.R.post("/auth/register",e,{headers:{Accept:"application/json","Content-Type":"application/json"}});return(0,r.V)("You Registers Succesfull !"),console.log("REGISTER RESPONSE:",a.data),d(a.data.data.accessToken),localStorage.setItem("token",a.data.data.accessToken),{status:a.status,data:a.data}}catch(o){let e=o.response?.data?.message||"Error register!";return a.rejectWithValue(e)}}),u=(0,n.createAsyncThunk)("user/getUser",async(e,a)=>{try{let e=await t.R.get("/users");return(0,r.V)("You get on User Succesfull"),e.data}catch(o){if(o.response?.data?.data?.message)return a.rejectWithValue(o.response.data.data.message);let e=o.response?.data?.message||"Error get All User!";return a.rejectWithValue(e)}}),g=(0,n.createAsyncThunk)("auth/login",async(e,a)=>{try{let o=await t.R.post("/auth/login",e);if(console.log("\uD83D\uDD0D API LOGIN RESPONSE:",o.data),console.log("\uD83D\uDD0D API LOGIN TOKEN:",o.data?.data?.accessToken),!o.data||!o.data.data.accessToken)return console.error("❌ API response does not contain accessToken!"),a.rejectWithValue("No accessToken in response");return d(o.data.data.accessToken),localStorage.setItem("jwt-token",o.data.data.accessToken),(0,r.V)("You Login Succesfull"),{status:o.status,data:o.data}}catch(e){return console.error("❌ LOGIN ERROR:",e.response?.data||e.message),a.rejectWithValue("Error during login!")}}),h=(0,n.createAsyncThunk)("auth/logout",async(e,a)=>{try{await t.R.post("/auth/logout"),(0,r.V)("You Logout Succesfull"),c(),localStorage.removeItem("token")}catch(e){return a.rejectWithValue("Error logOut !")}}),p=(0,n.createAsyncThunk)("auth/sendResetEmail",async(e,{rejectWithValue:a})=>{try{let a=await t.R.post("/auth/send-reset-email",{email:e});return(0,r.V)("Send Reset Email on you email Succesfull"),a.data}catch(e){return a(e.response?.data||"Error sending email")}}),y=(0,n.createAsyncThunk)("auth/resetPassword",async({newPassword:e,token:a},{rejectWithValue:o})=>{try{let o=await t.R.post("/auth/reset-pwd",{newPassword:e,token:a});return(0,r.V)("Reset on you password Succesfull"),o.data}catch(e){return o(e.response?.data||"Error resetting password")}}),f=(0,n.createAsyncThunk)("auth/refresh",async(e,{getState:a,rejectWithValue:o})=>{try{let e=a().auth.accessToken;if(console.log("\uD83D\uDD0D REFRESH TOKEN BEFORE REQUEST:",e),!e)return o("No access token found");d(e),(0,r.V)("Refresh of token Succesfull");let s=await t.R.get("/auth/refresh");return console.log("\uD83D\uDFE2 User data from refresh:",s.data),localStorage.setItem("jwt-token",s.data.accessToken||""),s.data}catch(e){if(e.response?.status===401)return console.error("❌ Unauthorized, logging out..."),o("Unauthorized");return o("Error refreshing user")}}),k=(0,n.createAsyncThunk)("user/confirm-email",async({token:e},a)=>{try{let a=await t.R.post("/auth/confirm-email",{token:e});return console.log(a),d(a.data.data.accessToken),(0,r.V)("Email confirmed"),a.data}catch(o){if(console.log(o),o.response?.data?.data?.message)return a.rejectWithValue(o.response.data.data.message);let e=o.response?.data?.message||"Email has not been confirmed";return a.rejectWithValue(e)}}),T=(0,n.createAsyncThunk)("user/get-oauth-url",async(e,a)=>{try{let{data:e}=await t.R.get("/auth/get-oauth-url");return e}catch(e){if(e.response?.data?.data?.message)return a.rejectWithValue(e.response.data.data.message);return(0,r.U)("Oauth url failed"),a.rejectWithValue(e.message)}}),m=(0,n.createAsyncThunk)("user/refresh-session",async(e,a)=>{try{let e=await t.R.post("/auth/refresh");return d(e.data.accessToken),e.data}catch(e){return a.rejectWithValue(e.message)}},{condition:(e,a)=>{let o=a.getState();return null!==o.auth.accessToken}}),E=(0,n.createAsyncThunk)("user/confirm-oauth",async(e,a)=>{try{let a=await t.R.post("/auth/confirm-oauth",{code:e});return d(a.data.accessToken),a.data}catch(o){if(o.response?.data?.data?.message)return a.rejectWithValue(o.response.data.data.message);let e=o.response?.data?.message||"Oauth confirm failed";return(0,r.U)("confirmOauth url Error failed"),a.rejectWithValue(e)}});s()}catch(e){s(e)}})},6049:(e,a,o)=>{"use strict";o.a(e,async(e,s)=>{try{o.d(a,{V:()=>r,m:()=>l});var t=o(4800),n=e([t]);t=(n.then?(await n)():n)[0];let r=(e,{payload:a})=>{e.user=a.auth?.user??null,e.isLoading=!1},l=(e,a)=>{console.log("\uD83D\uDD04 handleLogin-Google TRIGGERED!"),console.log("\uD83D\uDD11 Payload отримано:",a.payload);let o=a.payload.accessToken??null;e.accessToken=o,e.isLoading=!1,e.isRefreshing=!1,e.isLoggedIn=!!o,console.log("✅ Новий токен, який записуємо в Redux:",o),o&&(console.log("\uD83D\uDCE6 Зберігаємо цей самий токен у LocalStorage"),localStorage.setItem("jwt-token",o)),console.log("✅ state після handleLogin:",e),(0,t.EV)(o)};s()}catch(e){s(e)}})},8129:(e,a,o)=>{"use strict";o.a(e,async(e,s)=>{try{o.d(a,{U:()=>l,V:()=>r});var t=o(4391),n=e([t]);t=(n.then?(await n)():n)[0];let r=e=>t.toast.success(e,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!1,progress:void 0,theme:"colored",transition:t.Zoom}),l=e=>t.toast.error(e,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!1,progress:void 0,theme:"colored",transition:t.Zoom});s()}catch(e){s(e)}})},8263:e=>{e.exports={loaderContainer:"Loader_loaderContainer__7e4hV",loader:"Loader_loader__gANhr"}},9588:(e,a,o)=>{"use strict";o.a(e,async(e,s)=>{try{o.d(a,{WG:()=>g});var t=o(9198),n=o(4800),r=o(1898),l=o(6049),d=e([t,n,l]);[t,n,l]=d.then?(await d)():d;let c={user:null,token:null,accessToken:null,isLoggedIn:!1,isRefreshing:!1,isError:!1,isLoading:!1},i=(0,t.createSlice)({name:"auth",initialState:c,reducers:{loginSuccess:(e,a)=>{console.log("\uD83D\uDFE2 LOGIN SUCCESS REDUCER TRIGGERED",a.payload),e.accessToken=a.payload.accessToken,e.isLoggedIn=!0,e.user=a.payload.user,localStorage.setItem("jwt-token",a.payload.accessToken),console.log("✅ Token set in Redux & LocalStorage:",e.accessToken)},setToken:(e,a)=>{console.log("\uD83D\uDD04 setToken action received:",a.payload),a.payload.accessToken?(e.accessToken=a.payload.accessToken,e.isLoggedIn=!0,console.log("✅ New accessToken - Token записаний у Redux:",e.accessToken),console.log("✅ isLoggedIn в setToken (falce/true):",e.isLoggedIn)):console.warn("⚠️ No accessToken provided in setToken!"),a.payload.user?e.user=a.payload.user:e.user=null},logOut:e=>{e.accessToken=null,e.isLoggedIn=!1,e.user=null,localStorage.removeItem("jwt-token")}},extraReducers:e=>{e.addCase(n.kz.fulfilled,(e,a)=>{console.log("REGISTER SUCCESS:",a.payload),console.log("\uD83D\uDFE2 Expected `accessToken`:",a.payload?.data?.data?.accessToken),e.user={name:a.payload.data.data.user.name,email:a.payload.data.data.user.email},a.payload?.data?.data?.accessToken?(e.accessToken=a.payload.data.data.accessToken,localStorage.setItem("jwt-token",a.payload.data.data.accessToken),(0,n.EV)(a.payload.data.data.accessToken)):console.warn("⚠️ Register response does not contain accessToken!"),e.isLoggedIn=!0,e.isLoading=!1}).addCase(n.E8.fulfilled,(e,a)=>{console.log("\uD83D\uDFE2 logIn.fulfilled TRIGGERED!"),console.log("\uD83D\uDD04 handleLogin TRIGGERED!"),console.log("\uD83D\uDD11 Payload отримано:",a.payload),console.log("\uD83D\uDCCC Отримано токен:",a.payload?.data?.data?.accessToken),e.user={name:a.payload.data.data.user.name,email:a.payload.data.data.user.email};let o=a.payload.data.data.accessToken??null;e.accessToken=o,e.isLoading=!1,e.isRefreshing=!1,e.isLoggedIn=!!o,console.log("✅ Новий токен, який записуємо в Redux:",o),o&&(console.log("\uD83D\uDCE6 Зберігаємо цей самий токен у LocalStorage"),localStorage.setItem("jwt-token",o)),console.log("✅ state після handleLogin:",e),(0,n.EV)(o),console.log("✅ Token успішно записано в Redux:",e.accessToken),console.log("✅ isLoggedIn SET TO TRUE in Redux:",e.isLoggedIn),console.log("\uD83D\uDCCC New Redux State:",e)}).addCase(n.je.fulfilled,()=>c).addCase(n.$4.pending,e=>{e.isRefreshing=!0}).addCase(n.$4.fulfilled,(e,a)=>{console.log("\uD83D\uDFE2 REFRESH SUCCESS:",a.payload),e.user={id:a.payload.id,name:a.payload.name,email:a.payload.email},a.payload.accessToken?(e.accessToken=a.payload.accessToken,localStorage.setItem("jwt-token",a.payload.accessToken)):console.warn("⚠️ Refresh response does not contain accessToken!"),e.isRefreshing=!1,e.isLoggedIn=!0}).addCase(n.$4.rejected,e=>{e.isRefreshing=!1,e.isLoggedIn=!1}).addCase(n.WT.pending,e=>{e.isLoading=!0,e.isError=!1}).addCase(n.WT.fulfilled,e=>{e.isLoading=!1}).addCase(n.WT.rejected,(e,a)=>{e.isLoading=!1,e.isError=a.payload}).addCase(n.xw.pending,e=>{e.isLoading=!0,e.isError=!1}).addCase(n.xw.fulfilled,e=>{e.isLoading=!1}).addCase(n.xw.rejected,(e,a)=>{e.isLoading=!1,e.isError=a.payload}).addCase(n.yd.fulfilled,l.m).addCase(n.jf.fulfilled,e=>{e.isLoading=!1}).addCase(n.dt.fulfilled,e=>{e.isLoading=!1}).addCase(n.wz.fulfilled,l.V).addCase(n.LE.pending,e=>{e.isRefreshing=!0}).addCase(n.LE.fulfilled,(e,a)=>{e.accessToken=a.payload.accessToken,e.isRefreshing=!1,e.isLoggedIn=!0}).addCase(n.LE.rejected,(e,a)=>{e.accessToken=null,e.isError=a.payload,e.isRefreshing=!1,e.isLoggedIn=!1}).addCase(r.REHYDRATE,(e,a)=>{if(a.payload){let o=a.payload;e.accessToken=o.auth?.accessToken??null,e.user=o.auth?.user??null,console.log("\uD83D\uDD0D isLoggedIn у payload:",o.auth?.isLoggedIn),e.isLoggedIn=JSON.parse(o.auth?.isLoggedIn??"false"),console.log("\uD83D\uDFE2 Updated state.isLoggedIn:",e.isLoggedIn),console.log("\uD83D\uDD25 REHYDRATE payload:",o),console.log("\uD83D\uDFE2 Updated state after REHYDRATE:",e)}}).addMatcher((0,t.isAnyOf)(n.kz.pending,n.E8.pending,n.jf.pending,n.dt.pending,n.yd.pending,n.wz.pending),e=>{e.isLoading=!0,e.isError=!1}).addMatcher((0,t.isAnyOf)(n.kz.rejected,n.E8.rejected,n.jf.rejected,n.dt.rejected,n.yd.rejected,n.wz.rejected),(e,a)=>{console.log("LOGIN ERROR:",a.payload),e.isLoading=!1,e.isLoggedIn=!1,e.isError="string"==typeof a.payload?a.payload:"Unknown error",(0,t.isAnyOf)(n.E8.rejected,n.yd.rejected)(a)&&(localStorage.removeItem("jwt-token"),(0,n.EV)(null))})}}),{loginSuccess:u,setToken:g}=i.actions;i.reducer,i.reducer,s()}catch(e){s(e)}})}};